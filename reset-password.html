<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Сброс пароля</title>
  <link rel="stylesheet" href="files/styles/index.css">
</head>
<body>
  <div class="container">
    <h2>Сброс пароля</h2>
    <div id="reset-request">
      <p>Введите e-mail, чтобы получить ссылку для сброса пароля:</p>
      <input type="text" id="reset-email" placeholder="E-mail">
      <button id="reset-request-btn">Отправить</button>
      <p id="reset-request-msg"></p>
    </div>
    <form id="reset-form" novalidate>
      <p>Введите новый пароль:</p>
      <input type="password" id="new-password" placeholder="Новый пароль">
      <button id="reset-btn">Сбросить пароль</button>
      <p id="reset-msg"></p>
    </form>
  </div>
  <script>
    // Проверяем, есть ли токен в URL
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');
    if (token) {
      document.getElementById('reset-request').style.display = 'none';
      document.getElementById('reset-form').style.display = 'block';
      document.getElementById('reset-btn').onclick = async () => {
        const password = document.getElementById('new-password').value;
        const res = await fetch('http://localhost:3000/api/reset-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ token, password })
        });
        const data = await res.json();
        document.getElementById('reset-msg').textContent = data.message;
      };
    } else {
      document.getElementById('reset-request-btn').onclick = async () => {
        const email = document.getElementById('reset-email').value;
        const msg = await window.requestPasswordReset
          ? window.requestPasswordReset(email)
          : (await fetch('http://localhost:3000/api/request-password-reset', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ email })
            })).then(r => r.json()).then(d => d.message);
        document.getElementById('reset-request-msg').textContent = msg;
      };
    }
  </script>
</body>
</html> 